# 도커 볼륨
도커는 유니언 파일 시스템을 사용한다.
### 유니언 파일 시스템
- 여러 개의 파일 시스템을 **하나의 파일 시스템처럼 보이도록 하는 기술**

Docker에서 이미지 레이어를 겹쳐서 관리하기 위해 Union FS를 사용한다.

#### WHY❓
도커 컨테이너는 이미지를 기반으로 실행되며, 이미지는 여러 개의 레이어가 겹겹이 쌓여 존재한다.
만약 기존의 전통적인 파일시스템을 사용하면 **각 컨테이너마다 전체 파일을 복사**해야 하기 때문에 상당히 비효율적이다.

유니언 파일 시스템을 사용하면 공통된 Layer들을 공유해 저장 공간을 절약하고, 컨테이너 실행 속도를 높일 수 있다.

이는 하나의 이미지로부터 여러 컨테이너를 만들 수 있는 방법을 제공하고, 이미지에 변경된 내용을 저장할 수 있도록 해준다.

#### UnionFS 동작 방식

1. Docker Image는 여러 개의 Read-Only 레이어로 구성
2. 컨테이너를 실행하면 최상위에 Read-Only 레이어가 추가
3. 파일을 수정ㅎ면, 수정된 파일만 Read-Write 레이어에 복사된다.
4. 컨테이너가 삭제되면 Read-Write 레이어도 함께 삭제되지만, 기존 이미지 레이어는 그대로 유지된다.

> 즉, 변경된 데이터만 저장하므로 디스크 사용량을 줄이고 성능이 향상된다!

#### UnionFS 드라이버: Overlay
- 현대 Linux 배포판에서 많이 사용되고, Docker의 기본 드라이버

---
## 도커 볼륨 활용
DB, 웹 프로그램 등 업무에서 사용하는 애플리케이션에서 발생하는 데이터에 접근하고 이것을 공유하기 위해 도커 볼륨 기능을 사용한다.

또한, 제공하는 서비스의 데이터와 로직은 반드시 분리되어야 한다.

애플리케이션에서 발생하는 여러 가지 상황이 데이터에 영향을 주지 않고 언제든 다른 컨테이너로 이전할 수 있다면 운영자는 데이터를 안전하게 관리하고 운영할 수 있다.

**도커 볼륨**은 컨테이너에서 생성, 재사요할 수 있고 호스트 운영체제에서 직접 접근이 가능하다.
또한 보존되어야 하는 데이터를 유지하기 위한 메커니즘을 제공한다.

일반적으로 컨테이너 내부의 데이터는 컨테이너으 라이프 사이클과 연관되어 컨테이너 종료 시 삭제된다.

이를 영속적으로 관리하기 위한 방법으로 도커 볼륨을 사용하면 컨테이너가 삭제되어도 볼륨은 독립적으로 운영되기 때문에 삭제되지 않는 특징이 있다

> 즉, 컨테이너 내부 데이터들은 컨테이너를 삭제하면 같이 삭제되어 데이터를 보존하기가 어려웠는데, 이 데이터들을 외부 파일에 연동(마운트)시켜 컨테이너가 삭제되어도 데이터 손상없이 보존하도록 하는 기술이 바로 도커 볼륨이다.

---

## 도커 볼륨 타입
이렇게 호스트 파일 시스템의 특정 디렉토리와 컨테이너의 디렉토리를 연결하여 데이터를 저장하기 위해 다음과 같은 방법이 제공된다.

![](https://velog.velcdn.com/images/alstjr971/post/9f69fe23-9a11-4ca0-b175-06de2c694983/image.png)

### 1. volume
- 도커에서 권장하는 방법으로, docker volume create <이름> 을 통해 생성
- 도커 볼륨은 도커 명령어를 통해 관리 가능
- 여러 **컨테이너 간에 안전하게 공유** 가능
- 볼륨 드라이버를 통해 원격 호스트 및 클라우드 환경에 볼륨 내용을 저장하고 암호화 가능
- 새 볼륨으로 지정될 영역에 데이터를 미리 채우고 컨테이너에 연결하면 컨테이너 내에서 **바로 데이터 사용 가능**

### 2. bind mount
- 도커 볼륨 기법에 비해 제한적 사용
- **호스트 파일 시스템 절대 경로**: 컨테이너 내부 경로를 직접 마운트하여 사용
- 컨테이너 실행 시 지정하여 사용하고, 컨테이너 제거 시 바인드 마운트는 해제되지만 호스트 디렉토리는 유지된다.

### 3. tmpfs mount
- bind 마운트 방법은 컨테이너가 중지된 후에도 데이터를 유지할 수 있지만 tmpfs 마운트 방법은 임시적이며 호스트 메모리에서만 지속된다.
- 따라서 컨테이너가 중지되면 tmpfs 마운트가 제거되고 내부 기록된 파일도 유지되지 않는다.
- 중요한 파일을 임시로 사용할 경우에 유용
